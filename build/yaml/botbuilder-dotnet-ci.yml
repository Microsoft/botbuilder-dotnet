#
# Build configuration file to run build BotBuilder-DotNet-master-CI-PR on azure pipelines
#
name: TestBuild-$(Build.BuildId)
variables:
  ApiCompatVersion: 4.6.3
  BotBuilderDll: Microsoft.Bot.Builder.AI.Luis,Microsoft.Bot.Builder.AI.QnA,Microsoft.Bot.Builder.ApplicationInsights,Microsoft.Bot.Builder.Azure,Microsoft.Bot.Builder.Dialogs,Microsoft.Bot.Builder.Integration.ApplicationInsights.Core,Microsoft.Bot.Builder.Integration.AspNet.Core,Microsoft.Bot.Builder.TemplateManager,Microsoft.Bot.Builder.Testing,Microsoft.Bot.Builder,Microsoft.Bot.Configuration,Microsoft.Bot.Connector,Microsoft.Bot.Schema,Microsoft.Bot.Streaming
  BuildConfiguration: Debug-Windows
  BuildPlatform: any cpu
  CoverallsToken: define this in Azure
  GitHubCommentApiKey: define this in Azure
  IsBuildServer: true
  Parameters.solution: Microsoft.Bot.Builder.sln
  PreviewPackageVersion: 4.6.0-preview-$(Build.BuildNumber)
  ReleasePackageVersion: 4.6.0-preview-$(Build.BuildNumber)

#Multi-configuration and multi-agent job options are not exported to YAML. Configure these options using documentation guidance: https://docs.microsoft.com/vsts/pipelines/process/phases
stages:
- stage: API_Compatibility_Validation
  jobs:
  - job: generator
    pool:
      name: Hosted Windows 2019 with VS2019
    steps:
    - bash: echo "##vso[task.setVariable variable=legs;isOutput=true]{'a':{'myvar':'A'}, 'b':{'myvar':'B'}}"
      name: mtrx
  # This expands to the matrix
  #   a:
  #     myvar: A
  #   b:
  #     myvar: B
  - job: runner
    dependsOn: generator
    strategy:
      matrix: $[ dependencies.generator.outputs['mtrx.legs'] ]
    steps:
    - script: echo $(myvar) # echos A or B depending on which leg is running
